<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card-Di Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #f4f8ff; margin: 0 auto; padding: 20px; max-width: 800px; font-size: clamp(1.2rem, 4vw, 1.6rem); line-height: 1.4; }
    textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-family: monospace; }
    button { background: #007bff; color: #fff; padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; margin: 10px 5px; font-size: 1rem; }
    .portada { width: 90%; display: block; margin: 0 auto 10px; border-radius: 8px; }
    .logo { width: 15%; max-width: 120px; min-width: 60px; height: auto; border-radius: 50%; display: block; margin: -50px auto 10px; border: 4px solid #fff; background: #fff; }
    h2, h3, .descripcion, .ubicacion-line, .redes-line { text-align: center; }
    h2 { font-size: clamp(1.6rem, 6vw, 2.4rem); color: #4a90e2; margin: 10px 0; }
    h3 { font-size: clamp(1.4rem, 5vw, 1.8rem); color: #333; margin: 8px 0; }
    .descripcion { font-size: clamp(1.6rem, 5vw, 2rem); margin: 8px 0; color: #555; }
    details { margin: 15px 0; border-radius: 6px; overflow: hidden; }
    details summary { background: #007bff; color: #fff; padding: 15px; font-size: clamp(1.4rem, 4vw, 1.8rem); cursor: pointer; font-weight: 600; }
    .contenido { padding: 15px; background: #fff; font-size: clamp(1rem, 3vw, 1.4rem); }
    .contacto, .qr, .firma, .descargar { text-align: center; margin: 20px 0; }
    .redes-line { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 10px; }
    .redes-line img { width: 48px; height: 48px; border-radius: 50%; cursor: pointer; transition: transform 0.2s; }
    .redes-line img:hover { transform: scale(1.1); }
    pre { background: #eee; padding: 15px; border-radius: 6px; white-space: pre-wrap; font-size: 1rem; display: none; height: auto; max-height: 10em; overflow: auto; }
  </style>
</head>
<body>
  <h1>üöÄ Card-Di Generator</h1>
  <p>Pega aqu√≠ tu contenido etiquetado (#PORTADA, #LOGO, #TITULO, etc.) y luego haz clic en Generar.</p>
  <textarea id="entradaDatos" placeholder="#PORTADA:\n...\n#LOGO:\n...\n#TITULO:\n...\n#DESCRIPCION:\n...\n#SECCIONES:\n&&...\n#MAPA:\n...\n#UBICACION:\n...\n#REDES:\n...\n#LINK_QR:\n..."></textarea>
  <button id="btnGenerar" onclick="generarTarjeta()">üé® Generar Tarjeta</button>
  <div id="vistaPrevia" style="margin-top:20px;"></div>
  <pre id="codigoGenerado" style="margin-top:20px;"></pre>
  <button id="btnCopiar" style="display:none;" onclick="copiarHTML()">üìã Copiar C√≥digo de Tarjeta</button>

  <script>
    function generarTarjeta() {
      const texto = document.getElementById('entradaDatos').value || '';
      if (!texto.trim()) return alert('Por favor, pega el contenido.');
      const datos = {};
      texto.split(/\n(?=#)/).forEach(block => {
        const match = block.match(/^#(\w+):\s*([\s\S]*)$/);
        if (match) datos[match[1]] = match[2].trim();
      });
      let html = '';
      if (datos.PORTADA) html += `<img class="portada" src="${datos.PORTADA}" alt="Portada">`;
      if (datos.LOGO) html += `<img class="logo" src="${datos.LOGO}" alt="Logo">`;
      if (datos.TITULO) html += `<h2>${datos.TITULO}</h2>`;
      if (datos.DESCRIPCION) html += `<h3 class='descripcion'>${datos.DESCRIPCION}</h3>`;
      if (datos.QUIENES_SOMOS) html += `<h3>${datos.QUIENES_SOMOS}</h3>`;
      if (datos.SECCIONES) {
        datos.SECCIONES.split('&&').filter(s => s.trim()).forEach(s => {
          const [titulo, ...cuerpo] = s.trim().split('\n');
          const content = cuerpo.map(line => {
            if (/https?:\/\/.*\.(jpg|jpeg|png|gif)/i.test(line)) {
              return `<img src="${line}" style="width:90%;display:block;margin:10px auto;">`;
            } else if (/https?:\/\/(www\.)?youtube\.com|youtu\.be\//.test(line)) {
              const videoId = line.includes('embed') ? line.split('embed/')[1] : line.split('v=')[1]?.split('&')[0];
              return videoId ? `<iframe width="90%" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen style="display:block;margin:10px auto;"></iframe>` : `<p>${line}</p>`;
            }
            return `<p>${line}</p>`;
          }).join('');
          html += `<details><summary>${titulo.trim()}</summary><div class="contenido">${content}</div></details>`;
        });
      }
      if (datos.MAPA) {
        html += `<div class="qr" style="text-align:center;margin:20px 0;">
                  <a href="${datos.MAPA}" target="_blank">
                    <button>üìç Ver ubicaci√≥n en Google Maps</button>
                  </a>
                </div>`;
      }
      if (datos.UBICACION) {
        html += `<div class="contacto ubicacion-line">
          ${datos.UBICACION.split('\n').map(line => `<div>${line}</div>`).join('')}
        </div>`;
      }
      if (datos.REDES) {
        const iconMap = {
          Facebook: 'https://i.ibb.co/6JJ5FZ1S/IFbook.png',
          Instagram: 'https://i.ibb.co/chCqtLkw/IInstagram.png',
          Youtube: 'https://i.ibb.co/VYxJpn7X/IYoutube.png',
          Whatsapp: 'https://i.ibb.co/bgnHxP1y/IWapp.png',
          Tiktok: 'https://i.ibb.co/nsy5C1y9/ITiktok.png',
          Twitter: 'https://i.ibb.co/FqfRcjkg/ITwitter.png',
          Linkedin: 'https://i.ibb.co/G33VkpGb/ILinkedin.png'
        };
        html += `<div class="redes-line">`;
        datos.REDES.split('\n').forEach(line => {
          const [red, url] = line.split(':').map(v => v.trim());
          const icon = iconMap[red];
          if (icon) {
            if (url) {
              let href = red === 'Whatsapp' && !url.includes('http') ? `https://wa.me/${url}` : url;
              html += `<a href="${href}" target="_blank"><img src="${icon}" alt="${red}"></a>`;
            } else {
              html += `<img src="${icon}" alt="${red}" title="Sin enlace">`;
            }
          }
        });
        html += `</div>`;
      }
      if (datos.LINK_QR) {
        html += `<div class="qr" style="text-align:center;">
          <h3>Escanea para acceder</h3>
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(datos.LINK_QR)}" alt="QR">
        </div>`;
      }
      html += `<div class="descargar"><button onclick="descargarVCF('${datos.TITULO}', '${datos.UBICACION}')">üì• Descargar Contacto</button></div>`;
      html += `<div class="firma"><p>Desarrollado por <a href='https://wa.me/573117715353'>SupensionPlus</a></p></div>`;
      document.getElementById('vistaPrevia').innerHTML = html;
      const pre = document.getElementById('codigoGenerado');
      pre.textContent = document.getElementById('vistaPrevia').innerHTML;
      pre.style.display = 'block';
      document.getElementById('btnCopiar').style.display = 'inline-block';
      document.querySelectorAll('details').forEach(d => d.addEventListener('toggle', function() {
        if (this.open) document.querySelectorAll('details').forEach(o => { if (o !== this) o.removeAttribute('open'); });
      }));
    }

    function copiarHTML() {
      const codigo = document.getElementById('codigoGenerado');
      navigator.clipboard.writeText(codigo.textContent)
        .then(() => alert('‚úÖ C√≥digo copiado'))
        .catch(() => alert('‚ùå Error al copiar'));
    }

    function descargarVCF(nombre, datosUbicacion) {
      const vcf = `BEGIN:VCARD\nVERSION:3.0\nFN:${nombre}\nNOTE:${datosUbicacion}\nEND:VCARD`;
      const blob = new Blob([vcf], { type: 'text/vcard' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'contacto.vcf';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
