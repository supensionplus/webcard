<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card-Di Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #f4f8ff; margin: 0 auto; padding: 20px; max-width: 800px; font-size: clamp(1.2rem, 4vw, 1.6rem); line-height: 1.4; }
    textarea { width: 100%; height: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-family: monospace; }
    button { background: #007bff; color: #fff; padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; margin: 10px 5px; font-size: 1rem; }
    .portada { width: 90%; display: block; margin: 0 auto 10px; border-radius: 8px; }
    .logo { width: 15%; max-width: 120px; min-width: 60px; height: auto; border-radius: 50%; display: block; margin: -50px auto 10px; border: 4px solid #fff; background: #fff; }
    h2, h3, .descripcion, .ubicacion-line, .redes-line { text-align: center; }
    h2 { font-size: clamp(1.6rem, 6vw, 2.4rem); color: #4a90e2; margin: 10px 0; }
    h3 { font-size: clamp(1.4rem, 5vw, 1.8rem); color: #333; margin: 8px 0; }
    .descripcion { font-size: clamp(1.6rem, 5vw, 2rem); margin: 8px 0; color: #555; }
    details { margin: 15px 0; border-radius: 6px; overflow: hidden; }
    details summary { background: #007bff; color: #fff; padding: 15px; font-size: clamp(1.4rem, 4vw, 1.8rem); cursor: pointer; font-weight: 600; }
    .contenido { padding: 15px; background: #fff; font-size: clamp(1rem, 3vw, 1.4rem); }
    .contacto, .qr, .firma, .descargar { text-align: center; margin: 20px 0; }
    .redes-line { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-top: 10px; }
    .redes-line img { width: 48px; height: 48px; border-radius: 50%; cursor: pointer; transition: transform 0.2s; }
    .redes-line img:hover { transform: scale(1.1); }
    pre { background: #eee; padding: 15px; border-radius: 6px; white-space: pre-wrap; font-size: 1rem; display: none; height: auto; max-height: 10em; overflow: auto; }
  </style>
</head>
<body>
  <h1>üöÄ Card-Di Generator</h1>
  <p>Pega aqu√≠ tu contenido etiquetado (#PORTADA, #LOGO, #TITULO, etc.) y luego haz clic en Generar.</p>
  <textarea id="entradaDatos" placeholder="#PORTADA:\n...\n#LOGO:\n...\n#TITULO:\n...\n#DESCRIPCION:\n...\n#SECCIONES:\n&&...\n#MAPA:\n...\n#UBICACION:\n...\n#REDES:\n...\n#LINK_QR:\n..."></textarea>
  <button id="btnGenerar" onclick="generarTarjeta()">üé® Generar Tarjeta</button>
  <div id="vistaPrevia" style="margin-top:20px;"></div>
  <pre id="codigoGenerado" style="margin-top:20px;"></pre>
  <button id="btnCopiar" style="display:none;" onclick="copiarHTML()">üìã Copiar C√≥digo HTML</button>

  <script>
    function generarTarjeta() {
      const texto = document.getElementById('entradaDatos').value || '';
      if (!texto.trim()) return alert('Por favor, pega el contenido.');
      const datos = {};
      texto.split(/\n(?=#)/).forEach(block => {
        const match = block.match(/^#(\w+):\s*([\s\S]*)$/);
        if (match) datos[match[1]] = match[2].trim();
      });

      let ubicacion = datos.UBICACION || '';
      const telMatch = ubicacion.match(/\+\d{10,}/g) || [];
      const emailMatch = ubicacion.match(/\S+@\S+/) || [];
      const nombre = 'SupensionPlus';
      const telefono = telMatch[0] || '';
      const email = emailMatch[0] || '';

      const vcf = `BEGIN:VCARD\nVERSION:3.0\nFN:${nombre}\nTEL;TYPE=CELL:${telefono}\nEMAIL:${email}\nEND:VCARD`;
      const vcfBlob = new Blob([vcf], { type: 'text/vcard' });
      const vcfUrl = URL.createObjectURL(vcfBlob);

      document.querySelector('.descargar')?.remove();
      const descargarDiv = document.createElement('div');
      descargarDiv.className = 'descargar';
      descargarDiv.innerHTML = `<a href="${vcfUrl}" download="${nombre}.vcf"><button>üì• Descargar Contacto</button></a>`;
      document.getElementById('vistaPrevia').appendChild(descargarDiv);
    }

    function copiarHTML() {
      const codigo = document.getElementById('codigoGenerado');
      navigator.clipboard.writeText(codigo.textContent)
        .then(() => alert('‚úÖ C√≥digo copiado'))
        .catch(() => alert('‚ùå Error al copiar'));
    }
  </script>
</body>
</html>
